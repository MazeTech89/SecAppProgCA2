<svg xmlns="http://www.w3.org/2000/svg" width="1500" height="860" viewBox="0 0 1500 860" role="img" aria-label="Class diagram for Secure Blog Application">
  <defs>
    <marker id="arrow" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="8" markerHeight="8" orient="auto">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#000" />
    </marker>
    <style>
      .group { fill: #f3f4f6; stroke: #000; stroke-width: 2; stroke-dasharray: 7 6; }
      .box { fill: #fff; stroke: #000; stroke-width: 2; }
      .title { font: 700 16px Arial, sans-serif; fill: #111; }
      .text { font: 13px Arial, sans-serif; fill: #111; }
      .small { font: 12px Arial, sans-serif; fill: #111; }
      .line { stroke: #000; stroke-width: 2; fill: none; marker-end: url(#arrow); }
      .nolabel { fill: none; }
    </style>
  </defs>

  <!-- Explicit page background (prevents dark-mode viewers from making labels unreadable) -->
  <rect x="0" y="0" width="1500" height="860" fill="#ffffff" />

  <!-- Column groups -->
  <rect class="group" x="40" y="30" width="440" height="800" />
  <text class="title" x="60" y="60">Frontend (React)</text>

  <rect class="group" x="520" y="30" width="520" height="800" />
  <text class="title" x="540" y="60">Backend (Express.js)</text>

  <rect class="group" x="1080" y="30" width="380" height="800" />
  <text class="title" x="1100" y="60">Database (SQLite)</text>

  <!-- Frontend boxes (stacked for clean connectors) -->
  <rect class="box" x="70" y="95" width="380" height="88" />
  <text class="title" x="90" y="125">ReactApp (App.js)</text>
  <text class="text" x="90" y="150">+ isAuthenticated : boolean</text>
  <text class="text" x="90" y="170">+ handleLogin(), handleLogout()</text>

  <rect class="box" x="70" y="205" width="380" height="150" />
  <text class="title" x="90" y="235">UI Components</text>
  <text class="text" x="90" y="260">LoginUser</text>
  <text class="text" x="90" y="280">RegisterUser</text>
  <text class="text" x="90" y="300">UserList</text>
  <text class="text" x="90" y="320">BlogPosts</text>
  <text class="text" x="90" y="340">LogoutUser</text>

  <rect class="box" x="70" y="380" width="380" height="95" />
  <text class="title" x="90" y="410">CsrfClient (csrf.js)</text>
  <text class="text" x="90" y="435">+ getCsrfToken()</text>
  <text class="small" x="90" y="455">Caches token for write operations</text>

  <rect class="box" x="70" y="500" width="380" height="85" />
  <text class="title" x="90" y="530">HttpClient (axios)</text>
  <text class="text" x="90" y="555">+ get/post/put/delete()</text>

  <!-- Backend boxes (stacked for clean connectors) -->
  <rect class="box" x="550" y="95" width="460" height="130" />
  <text class="title" x="570" y="125">ApiServer (index.js)</text>
  <text class="small" x="570" y="150">Routes: /register, /login, /logout, /csrf-token</text>
  <text class="small" x="570" y="170">Routes: /users, /posts (GET/POST/PUT/DELETE)</text>
  <text class="small" x="570" y="190">Uses middleware + parameterized SQL</text>

  <rect class="box" x="550" y="245" width="460" height="110" />
  <text class="title" x="570" y="275">Security Middleware</text>
  <text class="text" x="570" y="300">AuthMiddleware.authenticateToken()</text>
  <text class="text" x="570" y="322">CsrfProtection.validateCsrf()</text>

  <rect class="box" x="550" y="375" width="460" height="110" />
  <text class="title" x="570" y="405">Security Services</text>
  <text class="text" x="570" y="430">JwtService.sign()/verify()</text>
  <text class="text" x="570" y="452">PasswordHasher.hash()/compare()</text>

  <rect class="box" x="550" y="505" width="460" height="85" />
  <text class="title" x="570" y="535">OutputEncoder</text>
  <text class="text" x="570" y="560">encode(text) (XSS mitigation for responses)</text>

  <rect class="box" x="550" y="610" width="460" height="95" />
  <text class="title" x="570" y="640">DbGateway (sqlite3)</text>
  <text class="text" x="570" y="665">run(), get(), all()</text>

  <!-- Database tables -->
  <rect class="box" x="1120" y="110" width="300" height="120" />
  <text class="title" x="1140" y="140">users</text>
  <text class="text" x="1140" y="165">id (PK), username (UNIQUE)</text>
  <text class="text" x="1140" y="185">password (bcrypt hash)</text>

  <rect class="box" x="1120" y="270" width="300" height="150" />
  <text class="title" x="1140" y="300">posts</text>
  <text class="text" x="1140" y="325">id (PK), user_id (FK users.id)</text>
  <text class="text" x="1140" y="345">title, content</text>
  <text class="text" x="1140" y="365">created_at</text>

  <!-- Clear, orthogonal connectors (minimise crossings) -->

  <!-- Frontend composition -->
  <path class="line" d="M 260 183 L 260 205" />
  <text class="small" x="270" y="198">renders</text>

  <path class="line" d="M 260 355 L 260 380" />
  <text class="small" x="270" y="372">uses</text>

  <path class="line" d="M 260 475 L 260 500" />
  <text class="small" x="270" y="490">uses</text>

  <!-- Frontend -> Backend via HTTP -->
  <path class="line" d="M 450 542 L 510 542 L 510 160 L 550 160" />
  <text class="small" x="480" y="530">HTTP</text>

  <!-- ApiServer uses middleware/services/db -->
  <path class="line" d="M 780 225 L 780 245" />
  <text class="small" x="790" y="240">protects</text>

  <path class="line" d="M 780 355 L 780 375" />
  <text class="small" x="790" y="370">uses</text>

  <path class="line" d="M 780 485 L 780 505" />
  <text class="small" x="790" y="500">encodes</text>

  <path class="line" d="M 780 590 L 780 610" />
  <text class="small" x="790" y="605">queries</text>

  <!-- DbGateway -> DB tables -->
  <path class="line" d="M 1010 658 L 1080 658 L 1080 170 L 1120 170" />
  <text class="small" x="1030" y="645">read/write</text>

  <path class="line" d="M 1010 658 L 1080 658 L 1080 330 L 1120 330" />
  <text class="small" x="1030" y="685">read/write</text>

  <!-- users FK -> posts -->
  <path class="line" d="M 1270 230 L 1270 270" />
  <text class="small" x="1280" y="255">FK</text>
</svg>
